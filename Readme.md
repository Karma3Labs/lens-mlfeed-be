# EigentTrust and Machine Learning for Non-Personalized Feed Recommendations on Lens Protocol

We use EigenTrust to separate trustworthy content from spam content, and combine it with a decision tree-based ML algorithm to classify and recommend trustworthy content to users on [Lens Protocol](lens.xyz).

## EigenTrust for Trust in open social networks
EigenTrust is a network graph-based algorithm that is commonly used in p2p systems to establish trust among peers. For a detailed discussion on the algorithm and our implementation of the algorithm, please refer to this [documentation](https://karma3-labs.gitbook.io/karma3labs/eigentrust).

We use the EigenTrust algorithm to calculate the trustworthiness of profiles in the network. In practical terms, we compute a Global Trust Score and a corresponding Global Rank for every profile in the network. To learn more, check out this [API](https://k3l.io/docs/api/basic/v1/) and the corresponding [repo](https://github.com/Karma3Labs/ts-lens/blob/main/README.md).

We make a few assumptions (will likely change in future iterations) about the profiles and the content that they generate: 
- **Assumption 1**: All profiles that are ranked above a certain threshold are trustworthy.  
- **Assumption 2**: Trustworthy profiles generate trustworthy content. 
- **Assumption 3**: Posts that are generated by top trustworthy profiles are likely to be good recommendations for all users.
## Machine Learning for Classifying Posts
Based on the assumptions we listed above, we create a training dataset and train a classifier model that classifies posts.

**Source Data**: [Lens BigQuery](https://docs.lens.xyz/docs/public-big-query#public) public dataset -  `lens-public-data.polygon.public_profile_post`

**Model**: Gradient boosted decision tree classifier model (using XGBoost library). 

**Classes**: The model classifies posts into 1 of 3 classes - 'YES', 'MAYBE' and 'NO'.

**Features**: Features include:
- Subset of columns from `lens-public-data.polygon.public_profile_post` 
- All columns from `lens-public-data.polygon.public_publication_stats` 
- EigenTrust score and rank of profiles that generated the posts (_joined on profile_id_)

**Training set**: 
- `'NO'` - sample of posts by the lowest N (_60,000 in this first version_) ranked profiles
- `'YES'` - sample of most engaging posts by the top M (_1,000 in this first version_) ranked profiles
- `'MAYBE'` - sample of other posts by the top M ranked profiles

For details on the training process, check out the code in this [Jupyter notebook](https://github.com/Karma3Labs/lens-recommendation-be/blob/main/notebooks/release/posts_labels_training.ipynb).

## Recommending Posts
Once we have trained a model, we persist it to disk (_on Google Cloud Storage_) and use it to classify any new posts that are generated. 
A regularly scheduled job (_hourly_ for now) pulls recent posts from Lens BigQuery, extracts features and executes the model to infer a classification. Posts that are classified as 'YES' and 'MAYBE' are then stratified (_80/20 for now_) sampled to generate non-personalized recommendations for all users.

To understand the details of the end-to-end pipeline used to generate recommendations, start [here](https://github.com/Karma3Labs/lens-recommendation-be/blob/main/pipeline/run_pipeline.sh).

# Recommendations are LIVE !
You can preview a live feed of post recommendations at this URL - https://content.lens.k3l.io/?strategy=ml-xgb-followship

You can also access the feed through a REST API at https://lens-api.k3l.io/feed?strategy=ml-xgb-followship

To inspect the model that is driving the preview feed, please take a look at https://github.com/Karma3Labs/lens-recommendation-be/blob/main/notebooks/release/20230522053757_model.json

If you are interested in running the pipeline and generate the feed yourself, please check out the [Developer Guide](https://github.com/Karma3Labs/lens-recommendation-be/blob/main/DeveloperGuide.md).
